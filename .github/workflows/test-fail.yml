name: test fail
on:
  workflow_dispatch:
    inputs:
      analyticaToken:
        description: 'api key'
        required: true

concurrency:
  group: ${{ github.workflow }}
  cancel-in-progress: true

jobs:
  testFail:
    runs-on: ubuntu-latest
    name: testFail
    steps:
    - name: Dump GitHub context
      env:
        GITHUB_CONTEXT: ${{ toJson(github) }}
        JOB_CONTEXT: ${{ toJson(job) }}
        STEPS_CONTEXT: ${{ toJson(steps) }}
      run: |
        echo "$GITHUB_CONTEXT";
        echo "$JOB_CONTEXT";
        echo "$STEPS_CONTEXT"
    - name: Try to fail
      id: failure
      run: exit 1

    - name: Dump GitHub context
      if: always()
      env:
        JOB_CONTEXT: ${{ toJson(job) }}
        STEPS_CONTEXT: ${{ toJson(steps) }}
      run: |
        echo "$JOB_CONTEXT";
        echo "$STEPS_CONTEXT"

    - name: notify analytica of build
      if: always()
      uses: andreigecanalytica/analytica.click.gh@2
      with:
        ANALYTICA_TOKEN: '${{ secrets.ANALYTICATOKEN }}'